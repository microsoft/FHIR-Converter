{% comment -%}
The following reference IDs are accepted by this template.

Location_ID_PV1_3: A resource Id, used to fill "location.location.reference" property. The resource is of "Location" type and generated based on "PV1.3" HL7 V2 identifier.
Location_ID_PV1_6: A resource Id, used to fill "location.location.reference" property. The resource is of "Location" type and generated based on "PV1.6" HL7 V2 identifier.
Location_ID_PV1_37: A resource Id, used to fill "hospitalization.destination.reference" property. The resource is of "Location" type and generated based on "PV1.37" HL7 V2 identifier.
Encounter_Hospitalization_Origin_ID: A resource Id, used to fill "hospitalization.origin.reference" property.
Practitioner_ID_PV1_7: A resource Id, used to fill "participant.individual.reference" property. The resource is of "Practitioner" type and generated based on "PV1.7" HL7 V2 identifier.
Practitioner_ID_PV1_8: A resource Id, used to fill "participant.individual.reference" property. The resource is of "Practitioner" type and generated based on "PV1.8" HL7 V2 identifier.
Practitioner_ID_PV1_9: A resource Id, used to fill "participant.individual.reference" property. The resource is of "Practitioner" type and generated based on "PV1.9" HL7 V2 identifier.
Practitioner_ID_PV1_17: A resource Id, used to fill "participant.individual.reference" property. The resource is of "Practitioner" type and generated based on "PV1.17" HL7 V2 identifier.
Practitioner_ID_PV1_52: A resource Id, used to fill "participant.individual.reference" property. The resource is of "Practitioner" type and generated based on "PV1.52" HL7 V2 identifier.
{% endcomment -%}

{% evaluate Location_ID_PV1_3 using 'ID/Location' PL: PV1.3 -%}
{% evaluate Location_ID_PV1_6 using 'ID/Location' PL: PV1.6 -%}
{% evaluate Practitioner_ID_PV1_7 using 'ID/Practitioner' XCN: PV1.7 -%}
{% evaluate Practitioner_ID_PV1_8 using 'ID/Practitioner' XCN: PV1.8 -%}
{% evaluate Practitioner_ID_PV1_9 using 'ID/Practitioner' XCN: PV1.9 -%}
{% evaluate Practitioner_ID_PV1_17 using 'ID/Practitioner' XCN: PV1.17 -%}
{% evaluate Practitioner_ID_PV1_52 using 'ID/Practitioner' XCN: PV1.52 -%}

{
    "fullUrl":"urn:uuid:{{ ID }}",
    "resource":{
        "resourceType": "Encounter",
        "id":"{{ ID }}",
        "class":
        {
            {% include 'DataType/CWECoding' mapping: 'CodeSystem/EncounterClass', CWE: PV1.2 -%}
        },
        {% if PV1.45 == null -%}
            "status":"unknown",
        {% endif -%}
        {% if PV1.45 -%}
            "status":"finished",
        {% endif -%}
        "location":
        [
            {
                {% if PV1.2.1.Value != "P" and Location_ID_PV1_3 -%}
                    "status":"active",
                {% endif -%}
                {% if PV1.2.1.Value == "P" and Location_ID_PV1_3 -%}
                    "status":"planned",
                {% endif -%}
                "location":
                {
                    {% if PV1.3 and Location_ID_PV1_3 -%}
                        "reference":"Location/{{ Location_ID_PV1_3 }}",
                    {% endif -%}
                },
            },
            {
                {% if PV1.6 and Location_ID_PV1_6 -%}
                    "status":"completed",
                {% endif -%}
                "location":
                {
                    {% if PV1.6 and Location_ID_PV1_6 -%}
                        "reference":"Location/{{ Location_ID_PV1_6 }}",
                    {% endif -%}
                },
            },
        ],
        "type":
        [
            {
                {% include 'DataType/CWECodeableConcept' mapping: 'CodeSystem/AdmissionType', CWE: PV1.4 -%}
            },
        ],
        "hospitalization":
        {
            "preAdmissionIdentifier":
            {
                {% include 'DataType/CX' CX: PV1.5 -%}
            },
            "reAdmission":
            {
                {% include 'DataType/CWECodeableConcept' mapping: 'CodeSystem/ReadmissionIndicator', CWE: PV1.13 -%}
            },
            "admitSource":
            {
                {% include 'DataType/CWECodeableConcept' CWE: PV1.14 -%}
            },
            "dischargeDisposition":
            {
                {% include 'DataType/CWECodeableConcept' CWE: PV1.36 -%}
            },
            "dietPreference":
            [
                {
                    {% include 'DataType/CWECodeableConcept' CWE: PV1.38 -%}
                },
            ],
            "destination":
            {
                {% if PV1.37 and Location_ID_PV1_37 -%}
                    "reference":"Location/{{ Location_ID_PV1_37 }}",
                {% endif -%}
            },
            "origin":
            {
                "reference":"{{ Encounter_Hospitalization_Origin_ID }}",
            },
        },
        "participant":
        [
            {
                "type":
                [
                    {
                        "coding":
                        [
                            {
                                {% if PV1.7 -%}
                                    "code":"ATND",
                                {% endif -%}
                                {% if PV2.13 -%}
                                    "code":"REF",
                                {% endif -%}
                                {% if PV1.7 -%}
                                    "system":"http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                {% endif -%}
                                {% if PV2.13 -%}
                                    "system":"http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                {% endif -%}
                                {% if PV1.7 -%}
                                    "display":"attender",
                                {% endif -%}
                            },
                        ],
                        {% if PV2.13 -%}
                            "text":"referrer",
                        {% endif -%}
                    },
                ],
                "individual":
                {
                    {% if PV1.7 and Practitioner_ID_PV1_7 -%}
                        "reference":"Practitioner/{{ Practitioner_ID_PV1_7 }}",
                    {% endif -%}
                },
            },
            {
                "type":
                [
                    {
                        "coding":
                        [
                            {
                                {% if PV1.8 -%}
                                    "code":"REF",
                                {% endif -%}
                                {% if PV1.8 -%}
                                    "system":"http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                {% endif -%}
                            },
                        ],
                        {% if PV1.8 -%}
                            "text":"referrer",
                        {% endif -%}
                    },
                ],
                "individual":
                {
                    {% if PV1.8 and Practitioner_ID_PV1_8 -%}
                        "reference":"Practitioner/{{ Practitioner_ID_PV1_8 }}",
                    {% endif -%}
                },
            },
            {
                "type":
                [
                    {
                        "coding":
                        [
                            {
                                {% if PV1.9 -%}
                                    "code":"CON",
                                {% endif -%}
                                {% if PV1.9 -%}
                                    "system":"http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                {% endif -%}
                            },
                        ],
                        {% if PV1.9 -%}
                            "text":"consultant",
                        {% endif -%}
                    },
                ],
                "individual":
                {
                    {% if PV1.9 and Practitioner_ID_PV1_9 -%}
                        "reference":"Practitioner/{{ Practitioner_ID_PV1_9 }}",
                    {% endif -%}
                },
            },
            {
                "type":
                [
                    {
                        "coding":
                        [
                            {
                                {% if PV1.17 -%}
                                    "code":"ADM",
                                {% endif -%}
                                {% if PV1.17 -%}
                                    "system":"http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                {% endif -%}
                            },
                        ],
                        {% if PV1.17 -%}
                            "text":"admitter",
                        {% endif -%}
                    },
                ],
                "individual":
                {
                    {% if PV1.17 and Practitioner_ID_PV1_17 -%}
                        "reference":"Practitioner/{{ Practitioner_ID_PV1_17 }}",
                    {% endif -%}
                },
            },
            {
                "type":
                [
                    {
                        "coding":
                        [
                            {
                                {% if PV1.52 -%}
                                    "code":"PART",
                                {% endif -%}
                                {% if PV1.52 -%}
                                    "system":"http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                {% endif -%}
                            },
                        ],
                        {% if PV1.52 -%}
                            "text":"Participation",
                        {% endif -%}
                    },
                ],
                "individual":
                {
                    {% if PV1.52 and Practitioner_ID_PV1_52 -%}
                        "reference":"Practitioner/{{ Practitioner_ID_PV1_52 }}",
                    {% endif -%}
                },
            },
        ],
        "serviceType":
        {
            {% include 'DataType/CWECodeableConcept' CWE: PV1.10 -%}
        },
        "identifier":
        [
            {
                {% include 'DataType/CX' CX: PV1.19 -%}
                "type":
                {
                    "coding":
                    [
                        {
                            {% if PV1.19 -%}
                                "system":"http://terminology.hl7.org/CodeSystem/v2-0203",
                            {% endif -%}
                        },
                    ],
                    {% if PV1.19 -%}
                        "text":"visit number",
                    {% endif -%}
                },
            },
            {
                {% include 'DataType/CX' CX: PV1.50 -%}
            },
        ],
        "period":
        {
            "start":"{{ PV1.44.Value | format_as_date_time }}",
            "end":"{{ PV1.45.Value | format_as_date_time }}",
        },
        "reasonCode":
        [
            {
                {% include 'DataType/CWECodeableConcept' CWE: PV2.3 -%}
            },
        ],
        "length":
        {
            "value":"{{ PV2.11.Value }}",
            {% if PV2.11 -%}
                "unit":"d",
            {% endif -%}
            {% if PV2.11 -%}
                "system":"http://unitsofmeasure.org/",
            {% endif -%}
        },
        "text":
        {
            "div":"{{ PV2.12.Value }}",
        },
        "priority":
        {
            {% include 'DataType/CWECodeableConcept' mapping: 'CodeSystem/EncounterPriority', CWE: PV2.25 -%}
        },
        "diagnosis":
        [
            {
                "use":
                {
                    {% comment -%} Placeholder provided for customization by users. If left empty, it will be removed in post-processing. {% endcomment -%}
                    {% if DG1.6.Value == "admitting" -%}
                    {% endif -%}
                },
            },
        ],
    },
    "request":{
        "method":"PUT",
        "url":"Encounter/{{ ID }}",
    },
},
