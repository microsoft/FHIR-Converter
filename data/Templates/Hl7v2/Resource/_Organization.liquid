{% assign namestring = "" -%}
{% evaluate organization_ID_MSH_22 using 'ID/Organization' XON: MSH.22 -%}
{% evaluate organization_ID_MSH_23 using 'ID/Organization' XON: MSH.23 -%}
{
    "fullUrl":"urn:uuid:{{ ID }}",
    "resource":{
        "resourceType": "Organization",
        "id":"{{ ID }}",

        {% if MSHHD1 -%}
            {% include 'DataType/HDOrganization' HD: MSHHD1 -%}
        {% endif -%}

        {% if MSHHD2 -%}
            {% include 'DataType/HDOrganization' HD: MSHHD2 -%}
        {% endif -%}

        {% if MSHXON1 -%}
            {% include 'DataType/XONOrganization' XON: MSHXON1 -%}
        {% endif -%}

        {% if MSHXON2 -%}
            {% include 'DataType/XONOrganization' XON: MSHXON2 -%}
        {% endif -%}

        {% if OBR_NTE -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_NTE -%}
        {% endif -%}

        {% if OBX_NTE -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: OBX_NTE -%}
        {% endif -%}
        
        {% if OBX_23 -%}
            {% include 'DataType/XONOrganization' XON: OBX_23 -%}
        {% endif -%}

        {% if OBR_SEG_10 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_SEG_10 -%}
        {% endif %}

        {% if OBR_SEG_16 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_SEG_16 -%}
        {% endif %}

        {% if OBR_SEG_34 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_SEG_34 -%}
        {% endif %}

        {% if OBR_SEG_35 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_SEG_35 -%}
        {% endif %}

        {% if ORC_SEG.21 %}
            {% include 'DataType/XONOrganization' XON: ORC_SEG.21 -%}
        {% endif %}

        {% if SPM -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: SPM -%}
        {% endif -%}

        {% if PID -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PID.4 -%}
        {% endif -%}

        {% if IN1_49 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN1_49.4 -%}
        {% endif -%}

        {% if IN1_3 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN1_3.4 -%}
        {% endif -%}

        {% if IN1_10 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN1_10.4 -%}
        {% endif -%}

        {% if IN2_1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN2_1.4 -%}
        {% endif -%}

        {% if IN2_61 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN2_61.4 -%}
        {% endif -%}

        {% if TXA -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: TXA -%}
        {% endif -%}

        {% if PV1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PV1 -%}
        {% endif -%}

        {% if PV2 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PV2 -%}
        {% endif -%}

        {% if EVN -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: EVN -%}
        {% endif -%}

        {% if IAM -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IAM -%}
        {% endif -%}

        {% if PD1_4 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PD1_4 -%}
        {% endif -%}

         {% if NK1_12 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: NK1_12.4 -%}
        {% endif -%}

         {% if NK1_33 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: NK1_33.4 -%}
        {% endif -%}

        {% include 'DataType/XONOrganization' XON: ROL.14 -%}
        {% if PD1.3 -%}
            {% include 'DataType/XONOrganization' XON: PD1.3.Repeats[0] -%}
        {% endif -%}
        {% if NK1.13 -%}
            {% include 'DataType/XONOrganization' XON: NK1.13.Repeats[0] -%}
        {% endif -%}
        {% include 'DataType/XONOrganization' XON: PRT.8.Repeats[0] -%}

        {% if RF1 -%}
            {% include 'DataType/XONOrganization' XON: RF1 -%}
        {% endif -%}

        {% if RF1_20 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: RF1_20 -%}
        {% endif -%}

        {% if DB1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: DB1 -%}
        {% endif -%}

        {% if GT1.21 -%}
            {% include 'DataType/XONOrganization' XON: GT1.21.Repeats[0] -%}
        {% endif -%}

        {% if PR1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PR1 -%}
        {% endif -%}

        {% if DG1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: DG1 -%}
        {% endif -%}

        {% if OBX %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBX -%}
        {% endif %}

        {% include 'DataType/CWEOrganization' CWE: RXA.17.Repeats[0] -%}

         {% if IN2_3 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN2_3 -%}
        {% endif -%}

        {% if IN2_70.70 -%}
            {% include 'DataType/XONOrganization' XON: IN2_70.70.Repeats[0] -%}
        {% endif -%}

        {% include 'DataType/HDOrganization_InternalValue' HD: AIP -%}

        {% if MSHHD1 %}
            {% if MSH.22 and organization_ID_MSH_22 -%}
                "partOf": 
                {
                    "reference":"Organization/{{ organization_ID_MSH_22 }}",
                }, 
            {% endif -%}
        {% endif %}
        {% if MSHHD2 %}
            {% if MSH.23 and organization_ID_MSH_23 -%}
                "partOf": 
                {
                    "reference":"Organization/{{ organization_ID_MSH_23 }}",
                },
            {% endif -%}
        {% endif %} 
        "address":
        [
            {
                "country":"{{ MSH.17.Value | get_property: 'CodeSystem/Countries', 'code' }}",
            }, 
            {
                {% if ORC_SEG_22 %}
                    {% for orc22 in ORC_SEG_22.Repeats %}
                        {% include 'DataType/XADAddress' XAD: orc22 -%}
                    {% endfor -%}    
                {% endif %}
            },     
            {
                {% include 'DataType/XAD' XAD: OBX_ORU.24 -%}
            },
            {
                {% if OBX_24 -%}
                    {% include 'DataType/XADAddress' XAD: OBX_24 -%}
                {% endif -%}
            },
            {% if OBX_ORU.25 -%}
                {
                    {% include 'DataType/XAD' XAD: OBX_ORU.24 -%}
                },
            {% endif -%}
            {% for gt1_5 in GT1.5.Repeats -%}
            {
                {% include 'DataType/XAD' XAD: gt1_5 -%}
            },
            {% endfor -%}
            {% for in1_5 in IN1.5.Repeats -%}
            {
                {% include 'DataType/XAD' XAD: in1_5 -%}
            },
            {% endfor -%}
            {% for in1_44 in IN1_11.44.Repeats -%}
            {
                {% include 'DataType/XAD' XAD: in1_44 -%}
            },
            {% endfor -%}
        ],
        "contact":
        [
            {
                "name":
                {
                    {% include 'DataType/XPN' XPN: NK1.30 -%}
                },
                "telecom":
                [
                    {% for nk131 in NK1.31.Repeats -%}
                        {
                            {% include 'DataType/XTN' XTN: nk131 -%}
                        },
                    {% endfor -%}
                    {% for gt1_46 in GT1.46.Repeats -%}
                        {
                            {% include 'DataType/XTN' XTN: gt1_46 -%}
                        },
                    {% endfor -%}
                    {% for orc23 in ORC_SEG_23.Repeats -%}
                    {
                        {% include 'DataType/XTN' XTN: orc23 -%}
                    },
            {% endfor -%}
                ],
                "address":
                {
                    {% include 'DataType/XAD' XAD: NK1.32 -%}
                },
                "purpose":
                {
                    {% include 'DataType/CWECodeableConcept' CWE: GT1.47 -%}
                },
            },
            {
                "name":
                {
                    {% include 'DataType/XPN' XPN: IN1.6 -%}
                },
            },
            {% for gt1_3 in GT1.3.Repeats -%}
            { 
                "name":
                {
                    
                    {% include 'DataType/XPN' XPN: gt1_3 -%}
                },
            },
            {% endfor -%}
            {% for gt1_45 in GT1.45.Repeats -%}
            { 
                "name":
                {
                    {% include 'DataType/XPN' XPN: gt1_45 -%}
                },
            },
            {% endfor -%}
            { 
                "name":
                {
                    {% include 'DataType/XPN' XPN: IN2_49.49.Repeats[0] -%}
                },
                "telecom":
                [
                    {% for in2_49 in IN2_49.50.Repeats -%}
                        {
                            {% include 'DataType/XTN' XTN: in2_49 -%}
                        },
                    {% endfor -%}
                ],
            },
        ],
        "type":
        [
            {
                {% include 'DataType/CWECodeableConcept' mapping: 'CodeSystem/OrganizationUnitType', CWE: PRT.7 -%}
            },
        ],
        "telecom":
        [
            {% for gt1_6 in GT1.6.Repeats -%}
                {
                    {% include 'DataType/XTN' XTN: gt1_6 -%}
                },
            {% endfor -%}
            {% for gt1_7 in GT1.7.Repeats -%}
                {
                    {% include 'DataType/XTN' XTN: gt1_7 -%}
                },
            {% endfor -%}
            {% for gt1_18 in GT1_51.18.Repeats -%}
                {
                    {% include 'DataType/XTN' XTN: gt1_18 -%}
                },
            {% endfor -%}
            {% for in1_7 in IN1.7.Repeats -%}
                {
                    {% include 'DataType/XTN' XTN: in1_7 -%}
                },
            {% endfor -%}       
            {% for in2_64 in IN2_49.64.Repeats -%}
                {
                    {% include 'DataType/XTN' XTN: in2_64 -%}
                },
            {% endfor -%}
        ],
        "identifier":
        [
            {% for gt1_2 in GT1.2.Repeats -%}
                {
                    {% include 'DataType/CX' CX: gt1_2 -%}
                },
            {% endfor -%}
            {% for gt1_29 in GT1_51.29.Repeats -%}
                {
                    {% include 'DataType/CX' CX: gt1_29 -%}
                },
            {% endfor -%}
            {% for in1_3 in IN1.3.Repeats -%}
                {
                    {% include 'DataType/CX' CX: in1_3 -%}
                },
            {% endfor -%}
            {% for in1_10 in IN1_11.10.Repeats -%}
                {
                    {% include 'DataType/CX' CX: in1_10 -%}
                },
            {% endfor -%}
        ],
        {% if org_name %}
            "name": "{{org_name}}",
        {% endif %}
        {% if IN1.4 -%}
            "name": {% include 'DataType/XONString' XON: IN1.4 -%}
        {% endif -%}

        {% if IN1_11.11 -%}
            {% for in1_11 in IN1_11.11.Repeats -%}
                    {% if in1_11 -%}
                        {% assign namevalue = in1_11.1.Value -%}
                    {% unless in1_11.1 -%}
                         {% assign namevalue =  in1_11.10.Value -%}
                    {% endunless -%}
                    {% endif -%}
                {% capture namestring %}{{ namestring | append: namevalue | append: ":" }}{% endcapture -%}
                {% endfor %}
            "name" : "{{ namestring | split: ":" | join: "+"}}",
        {% endif -%}
        {% if GT1_51.51 -%}
            {% for gt1_51 in GT1_51.51.Repeats -%}
                    {% if gt1_51 -%}
                        {% assign namevalue = gt1_51.1.Value -%}
                    {% unless gt1_51.1 -%}
                         {% assign namevalue =  gt1_51.10.Value -%}
                    {% endunless -%}
                    {% endif -%}
                {% capture namestring %}{{ namestring | append: namevalue | append: ":" }}{% endcapture -%}
                {% endfor %}
            "name" : "{{ namestring | split: ":" | join: "+"}}",
        {% endif -%}   
    },
    "request":{
        "method":"PUT",
        {% if Root_Template == "ADT_A29" -%}
            "method":"DELETE",
        {% endif -%} 
        "url":"Organization/{{ ID }}",
    },
},
