{% assign namestring = "" -%}
{% evaluate organization_ID_MSH_22 using 'ID/Organization' XON: MSH.22 -%}
{% evaluate organization_ID_MSH_23 using 'ID/Organization' XON: MSH.23 -%}
{
    "fullUrl":"urn:uuid:{{ ID }}",
    "resource":{
        "resourceType": "Organization",
        "id":"{{ ID }}",

        {% if MSHHD1 -%}
            {% include 'DataType/HDOrganization' HD: MSHHD1 -%}
        {% endif -%}

        {% if PRD.10 %}
            {% include 'DataType/XONOrganization'  XON: PRD.10 -%}
        {% endif %}

        {% if RQD -%}
            {% include 'DataType/CWEOrganization' CWE: RQD -%}
        {% endif -%}

        {% if MSHHD2 -%}
            {% include 'DataType/HDOrganization' HD: MSHHD2 -%}
        {% endif -%}

        {% if MSHXON1 -%}
            {% include 'DataType/XONOrganization' XON: MSHXON1 -%}
        {% endif -%}

        {% if MSHXON2 -%}
            {% include 'DataType/XONOrganization' XON: MSHXON2 -%}
        {% endif -%}

        {% if OBR_NTE -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_NTE -%}
        {% endif -%}

        {% if OBX_NTE -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: OBX_NTE -%}
        {% endif -%}
        
        {% if OBX_23 -%}
            {% include 'DataType/XONOrganization' XON: OBX_23 -%}
        {% endif -%}

        {% if OBR_SEG_10 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_SEG_10 -%}
        {% endif %}

        {% if OBR_SEG_16 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_SEG_16 -%}
        {% endif %}

        {% if OBR_SEG_34 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_SEG_34 -%}
        {% endif %}

        {% if OBR_SEG_35 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBR_SEG_35 -%}
        {% endif %}

        {% if ORC_SEG.21 %}
            {% include 'DataType/XONOrganization' XON: ORC_SEG.21 -%}
        {% endif %}

        {% if SPM -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: SPM -%}
        {% endif -%}

        {% if PID -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PID.4 -%}
        {% endif -%}

        {% if MRG -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: MRG.4 -%}
        {% endif -%}

        {% if IN1_49 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN1_49.4 -%}
        {% endif -%}

        {% if IN1_3 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN1_3.4 -%}
        {% endif -%}

        {% if IN1_10 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN1_10.4 -%}
        {% endif -%}

        {% if IN2_1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN2_1.4 -%}
        {% endif -%}

        {% if IN2_61 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN2_61.4 -%}
        {% endif -%}

        {% if TXA -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: TXA -%}
        {% endif -%}

        {% if PV1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PV1 -%}
        {% endif -%}

        {% if RXA_10 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: RXA_10 -%}
        {% endif -%}

        {% if ORC_12 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: ORC_12 -%}
        {% endif -%}

        {% if PV2 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PV2 -%}
        {% endif -%}

        {% if EVN -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: EVN -%}
        {% endif -%}

        {% if IAM -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IAM -%}
        {% endif -%}

        {% if PD1_4 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PD1_4 -%}
        {% endif -%}

        {% if FT1_20 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: FT1_20 -%}
        {% endif -%}

        {% if ACC -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: ACC -%}
        {% endif -%}

         {% if NK1_12 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: NK1_12.4 -%}
        {% endif -%}

         {% if NK1_33 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: NK1_33.4 -%}
        {% endif -%}

        {% if ROL.14 %}
            {% include 'DataType/XONOrganization' XON: ROL.14 -%}
        {% endif %}
        
        {% if PD1.3 -%}
            {% include 'DataType/XONOrganization' XON: PD1.3.Repeats[0] -%}
        {% endif -%}

        {% if FT1_32.32 -%}
            {% include 'DataType/XONOrganization' XON: FT1_32.32.Repeats[0] -%}
        {% endif -%}

        {% if FT1_33.33 -%}
            {% include 'DataType/XONOrganization' XON: FT1_33.33 -%}
        {% endif -%}

        {% if NK1.13 -%}
            {% include 'DataType/XONOrganization' XON: NK1.13.Repeats[0] -%}
        {% endif -%}

        {% if PRT %}
            {% include 'DataType/XONOrganization' XON: PRT, Org_Name: Org_Name -%}
        {% endif %}
       
        {% if RF1 -%}
            {% include 'DataType/XONOrganization' XON: RF1 -%}
        {% endif -%}

        {% if RF1_20 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: RF1_20 -%}
        {% endif -%}

        {% if DB1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: DB1 -%}
        {% endif -%}

        {% if GT1.21 -%}
            {% include 'DataType/XONOrganization' XON: GT1.21.Repeats[0] -%}
        {% endif -%}

        {% if PR1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: PR1 -%}
        {% endif -%}

        {% if DG1 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: DG1 -%}
        {% endif -%}

        {% if OBX %}
            {% include 'DataType/HDOrganization_InternalValue' HD: OBX -%}
        {% endif %}

        {% if RXO_14 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: RXO_14 -%}
        {% endif %}

        {% if ORC_10 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: ORC_10 -%}
        {% elsif ORC_19 %}
            {% include 'DataType/HDOrganization_InternalValue' HD: ORC_19 -%}
        {% endif %}
        {% if ORC.21 %}
            {% include 'DataType/XONOrganization' XON: ORC.21.Repeats[0] -%}
        {% endif %}
        {% include 'DataType/CWEOrganization' CWE: RXA.17.Repeats[0] -%}

        {% include 'DataType/CWEOrganization' CWE: RXO.32 -%}
        {% include 'DataType/CWEOrganization' CWE: RXE.40 -%}

        {% include 'DataType/CWEOrganization' CWE: FT1.13 -%}

        {% include 'DataType/CWEOrganization' CWE: RQ1_2.2 -%}

        {% include 'DataType/CWEOrganization' CWE: RQ1_4.4 -%}

         {% if IN2_3 -%}  
            {% include 'DataType/HDOrganization_InternalValue' HD: IN2_3 -%}
        {% endif -%}

        {% if IN2_70.70 -%}
            {% include 'DataType/XONOrganization' XON: IN2_70.70.Repeats[0] -%}
        {% endif -%}

        {% include 'DataType/HDOrganization_InternalValue' HD: AIP -%}

        {% if PDA_5 -%}
            {% include 'DataType/HDOrganization_InternalValue' HD: PDA_5.9 -%}
        {% endif -%}
        {% if PDA_8 -%}
            {% include 'DataType/HDOrganization_InternalValue' HD: PDA_8.9 -%}
        {% endif -%}

        {% if MSHHD1 %}
            {% if MSH.22 and organization_ID_MSH_22 -%}
                "partOf": 
                {
                    "reference":"Organization/{{ organization_ID_MSH_22 }}",
                }, 
            {% endif -%}
        {% endif %}
        {% if MSHHD2 %}
            {% if MSH.23 and organization_ID_MSH_23 -%}
                "partOf": 
                {
                    "reference":"Organization/{{ organization_ID_MSH_23 }}",
                },
            {% endif -%}
        {% endif %} 
        "address":
        [
            {
                "country":"{{ MSH.17.Value | get_property: 'CodeSystem/Countries', 'code' }}",
            }, 
            {% if ORC_SEG_22 %}
                {% for orc22 in ORC_SEG_22.Repeats %}
                {
                    {% include 'DataType/XADAddress' XAD: orc22 -%}
                },
                {% endfor -%}    
            {% endif %}
            {% if PRD.11 %}
                {% for PRD_11 in PRD.11.Repeats %}
                {
                    {% include 'DataType/XADAddress' XAD: PRD_11 -%}
                },
                {% endfor %}     
            {% endif %}
            {% if ORC.21 %}
                {% for orc22 in ORC.22.Repeats %}
                    {
                        {% include 'DataType/XAD' XAD: orc22 -%}
                    },
                {% endfor -%}    
            {% endif %}     
            {
                {% include 'DataType/XAD' XAD: OBX_ORU.24 -%}
            },
            {% if RXO.33 %}
            {
                {% include 'DataType/XAD' XAD: RXO.33 -%}
            },
            {% endif %}
            {% if RXE.40 %}
            {
                {% include 'DataType/XAD' XAD: RXE.41 -%}
            },
            {% endif %}
            {
                {% if OBX_24 -%}
                    {% include 'DataType/XADAddress' XAD: OBX_24 -%}
                {% endif -%}
            },
            {% if OBX_ORU.25 -%}
                {
                    {% include 'DataType/XAD' XAD: OBX_ORU.24 -%}
                },
            {% endif -%}
            
            {% for in1_5 in IN1.5.Repeats -%}
            {
                {% include 'DataType/XAD' XAD: in1_5 -%}
            },
            {% endfor -%}
            {% for in1_44 in IN1_11.44.Repeats -%}
            {
                {% include 'DataType/XAD' XAD: in1_44 -%}
            },
            {% endfor -%}
        ],
        "contact":
        [
            {
                "name":
                {
                    {% include 'DataType/XPN' XPN: NK1.30 -%}
                },
                "telecom":
                [
                    {% for nk131 in NK1.31.Repeats -%}
                        {
                            {% include 'DataType/XTN' XTN: nk131 -%}
                        },
                    {% endfor -%}
                    {% for gt1_46 in GT1.46.Repeats -%}
                        {
                            {% include 'DataType/XTN' XTN: gt1_46 -%}
                        },
                    {% endfor -%}
                    {% for orc23 in ORC_SEG_23.Repeats -%}
                    {
                        {% include 'DataType/XTN' XTN: orc23 -%}
                    },
            {% endfor -%}
                ],
                "address":
                {
                    {% include 'DataType/XAD' XAD: NK1.32 -%}
                },
                "purpose":
                {
                    {% include 'DataType/CWECodeableConcept' CWE: GT1.47 -%}
                },
            },
            {
                "name":
                {
                    {% include 'DataType/XPN' XPN: IN1.6 -%}
                },
            },
            {% for gt1_45 in GT1.45.Repeats -%}
            { 
                "name":
                {
                    {% include 'DataType/XPN' XPN: gt1_45 -%}
                },
            },
            {% endfor -%}
            { 
                "name":
                {
                    {% include 'DataType/XPN' XPN: IN2_49.49.Repeats[0] -%}
                },
                "telecom":
                [
                    {% for in2_49 in IN2_49.50.Repeats -%}
                        {
                            {% include 'DataType/XTN' XTN: in2_49 -%}
                        },
                    {% endfor -%}
                ],
            },
        ],
        {%- comment -%}
        "type":
        [
            {
                {% include 'DataType/CWECodeableConcept' mapping: 'CodeSystem/OrganizationUnitType', CWE: PRT.7 -%}
            },
        ],
        {%- endcomment -%}
        "telecom":
        [
            
            {% if PRD.13 %}
                {% for PRD_13 in PRD.13.Repeats %}
                    {
                        {% include 'DataType/XTN' XTN: PRD_13 -%}
                    },
                {% endfor %}
            {% endif %}
            
            {% for in1_7 in IN1.7.Repeats -%}
                {
                    {% include 'DataType/XTN' XTN: in1_7 -%}
                },
            {% endfor -%}       
            {% for in2_64 in IN2_49.64.Repeats -%}
                {
                    {% include 'DataType/XTN' XTN: in2_64 -%}
                },
            {% endfor -%}
            {% for rxo_36 in RXO.36.Repeats -%}
                {
                    {% include 'DataType/XTN' XTN: rxo_36 -%}
                },
            {% endfor -%}
            {% for rxe_45 in RXE.45.Repeats -%}
                {
                    {% include 'DataType/XTN' XTN: rxe_45 -%}
                },
            {% endfor -%}
            {% if ORC.21 %}
                {% for orc23 in ORC.23.Repeats %}
                    {
                        {% include 'DataType/XTN' XTN: orc23 -%}
                    },
                {% endfor -%}    
            {% endif %} 
        ],
        "identifier":
        [
            
            {% for in1_3 in IN1.3.Repeats -%}
                {
                    {% include 'DataType/CX' CX: in1_3 -%}
                },
            {% endfor -%}
            {% for in1_10 in IN1_11.10.Repeats -%}
                {
                    {% include 'DataType/CX' CX: in1_10 -%}
                },
            {% endfor -%}
        ],
        {% if org_name %}
            "name": "{{org_name}}",
        {% endif %}
        {% if aut_org_name %}
            "name": "{{aut_org_name}}",
        {% endif %}
        {% if IN1.4 -%}
            "name": {% include 'DataType/XONString' XON: IN1.4 -%}
        {% endif -%}

        {% if IN1_11.11 -%}
            {% for in1_11 in IN1_11.11.Repeats -%}
                    {% if in1_11 -%}
                        {% assign namevalue = in1_11.1.Value -%}
                    {% unless in1_11.1 -%}
                         {% assign namevalue =  in1_11.10.Value -%}
                    {% endunless -%}
                    {% endif -%}
                {% capture namestring %}{{ namestring | append: namevalue | append: ":" }}{% endcapture -%}
                {% endfor %}
            "name" : "{{ namestring | split: ":" | join: "+"}}",
        {% endif -%}
        {% if GT1_51.51 -%}
            {% for gt1_51 in GT1_51.51.Repeats -%}
                    {% if gt1_51 -%}
                        {% assign namevalue = gt1_51.1.Value -%}
                    {% unless gt1_51.1 -%}
                         {% assign namevalue =  gt1_51.10.Value -%}
                    {% endunless -%}
                    {% endif -%}
                {% capture namestring %}{{ namestring | append: namevalue | append: ":" }}{% endcapture -%}
                {% endfor %}
            "name" : "{{ namestring | split: ":" | join: "+"}}",
        {% endif -%}   
    },
    "request":{
        "method":"PUT",
        {% if Root_Template == "ADT_A29" -%}
            "method":"DELETE",
        {% endif -%} 
        "url":"Organization/{{ ID }}",
    },
},
