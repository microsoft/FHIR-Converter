{% comment -%}
The following reference IDs are accepted by this template.

Location_ID_ROL_13: A resource Id, used to fill "location.reference" property. The resource is of "Location" type and generated based on "ROL.13" HL7 V2 identifier.
Practitioner_ID_OBX_16: A resource Id, used to fill "practitioner.reference" property. The resource is of "Practitioner" type and generated based on "OBX.16" HL7 V2 identifier.
Organization_ID_OBX_23: A resource Id, used to fill "organization.reference" property. The resource is of "Organization" type and generated based on "OBX.23" HL7 V2 identifier.
Organization_ID_PRT_8: A resource Id, used to fill "organization.reference" property. The resource is of "Organization" type and generated based on "PRT.8" HL7 V2 identifier.
Organization_ID_ORC_21: A resource Id, used to fill "organization.reference" property. The resource is of "Organization" type and generated based on "ORC.21" HL7 V2 identifier.
{% endcomment -%}

{% evaluate Organization_ID_PRT_8 using 'ID/Organization' XON: PRT.8.Repeats[0] -%}
{
    "fullUrl":"urn:uuid:{{ ID }}",
    "resource":{
        "resourceType": "PractitionerRole",
        "id":"{{ ID }}",
        {% include 'DataType/XCNPractitionerRole' XCN: PD1.4 -%}        
        {% include 'DataType/NDLPractitionerRole' NDL: OBR_32 -%}
        {% if OBR_34 %}
            "code": [
                {
                    "coding": [
                        {
                            "code": "TECH",
                        },
                    ],
                }
            ],
            {% include 'DataType/NDLPractitionerRole' NDL: OBR_34 -%}
        {% endif %}
        {% if OBR_35 %}
            "code": [
                {
                    "coding": [
                        {
                            "code": "TRANS",
                        },
                    ],
                }
            ],
            {% include 'DataType/NDLPractitionerRole' NDL: OBR_35 -%}
        {% endif %}
        {% if PRD %}
            "code": [
                {
                    "coding": [
                        {% for prd_1 in PRD.1.Repeats %}
                            {% include 'DataType/CWECodeableConceptRepeatable' mapping: 'CodeSystem/ProviderRole_PractitionerRole', CWE: prd_1 -%},
                        {% endfor %}
                    ],
                }
            ],
        {% endif %}
        {% if PRT.4 %}
            "code": [
                {
                    "coding": [
                        {% include 'DataType/CWECodeableConceptRepeatable' mapping: 'CodeSystem/PractitionerRole_Participation', CWE: PRT.4 -%},
                    ],
                }
            ],
        {% endif %}
        "identifier":
        [
            {
                {% include 'DataType/EIIdentifier' EI: ROL.1 -%}
            },
            {
                {% include 'DataType/PLN' PLN: PRT.24 -%}
            },
        ],
        "code": [{    
            "coding" : [
                {% if RXO or ORC_12 %}
                    {  
                        "code" : "ordering-provider",
                        "system" : "http://example.com/v2-to-fhir-converter/CodeSystem/PractitionerRole",
                        "display" : "Ordering Provider",
                    },
                {% endif %}
                {% if RQD_ORC_12 %}
                    {  
                        "code" : "ordering-provider",
                        "system" : "http://example.com/v2-to-fhir-converter/CodeSystem/PractitionerRole",
                        "display" : "Ordering Provider",
                    },
                {% endif %}
                {% if ORC_10 %}
                    {  
                        "code" : "entered-by",
                        "display" : "Entered by",
                        "system" : "http://example.com/v2-to-fhir-converter/Codesystem/PractitionerRole",
                    },
                {% endif %}
                {% if ORC_19 %}
                    {  
                        "code" : "action-by",
                        "display" : "Action by",
                        "system" : "http://example.com/v2-to-fhir-converter/Codesystem/PractitionerRole",
                    },
                {% endif %}
                {% if OBXXCN1 %}
                    {  
                        "code" : "ResponsibleObserver",
                        "system" : "http://example.com/v2-to-fhir-converter/Codesystem/PractitionerRole",
                    },
                {% endif %}
                {% if OBXXCN2 %}
                    {
                        "code" : "LabMedicalDirector",
                        "system" : "http://example.com/v2-to-fhir-converter/Codesystem/PractitionerRole",
                    },
                {% endif %}
                {% if SCH_12.12 %}
                    {
                        "code" : "placer-contact",
                        "display" : "Placer Contact",
                        "system" : "http://example.com/v2-to-fhir-converter/CodeSystem/additional-practitioner-role",
                    },
                {% endif %}
                {% if SCH_16.16 %}
                    {
                        "code" : "filler-contact",
                        "display" : "Filler Contact",
                        "system" : "http://example.com/v2-to-fhir-converter/CodeSystem/additional-practitioner-role",
                    },
                {% endif %}
                {% if SCH_20.20 %}
                    {
                        "code" : "enterer",
                        "display" : "Enterer",
                        "system" : "http://example.com/v2-to-fhir-converter/CodeSystem/additional-practitioner-role",
                    },
                {% endif %}
                {% if ORC_pracrole.12 -%}
                    {
                        "code" : "ordering-provider",
                        "display" : "Ordering Provider",
                        "system" : "http://example.com/v2-to-fhir-converter/CodeSystem/additional-practitioner-role",
                    },
                {% endif %}
                {% if OBR_serv.16 %}
                    {
                        "code" : "ordering-provider",
                        "display" : "Ordering Provider",
                        "system" : "http://example.com/v2-to-fhir-converter/CodeSystem/PractitionerRole",
                    },
                {% endif %}
                {% if RXE -%}
                    {  
                        "code" : "ordering-provider",
                        "system" : "http://example.com/v2-to-fhir-converter/CodeSystem/PractitionerRole",
                        "display" : "Ordering Provider",
                    },
                {% endif %}
                ],
            },       
            {
                {% include 'DataType/CWECodeableConcept' mapping: 'CodeSystem/Role', CWE: ROL.3 -%}
                {% include 'DataType/CWECodeableConcept' mapping: 'CodeSystem/Participation', CWE: ROL.4 -%}
            }
        ],
        
        {% include 'DataType/XCNPractitionerRole' XCN: ROL.4 -%}
        "period":
        {
            "start":"{{ ROL.5.Value | format_as_date_time }}",
            "start":"{{ PRT.11.Value | format_as_date_time }}",
            "start":"{{ PRD.8.Value | format_as_date_time }}",
            "end":"{{ PRD.9.Repeats[0].Value | format_as_date_time }}",
            "end":"{{ ROL.6.Value | format_as_date_time }}",
            "end":"{{ PRT.12.Value | format_as_date_time }}",
        },
        "telecom":
        [
            {
                {% include 'DataType/XTN' XTN: ROL.12 -%}
            },
            {
                {% include 'DataType/XTN' XTN: PRT.15.Repeats[0] -%}
            },
        ],
        "location":
        [
            {
                {% if ROL.13 and Location_ID_ROL_13 -%}
                    "reference":"Location/{{ Location_ID_ROL_13 }}",
                {% endif -%}
            },
            {% if SCH_12.15 -%}

                {% if SCH_12.15.5 or SCH_12.15.9 -%}
                    {% if SCH_12.15.5 and SCH_12.15.9 -%}
                        {% assign PL_Value_Except_PL5_PL9 = SCH_12.15.Value | remove: SCH_12.15.5.Value | remove: SCH_12.15.9.Value %}
                    {% endif -%}
                    {% if SCH_12.15.5 and SCH_12.15.9 == null or SCH_12.15.9 == "" -%}
                        {% assign PL_Value_Except_PL5_PL9= SCH_12.15.Value | remove: SCH_12.15.5.Value %}
                    {% endif -%}
                    {% if SCH_12.15.9 and SCH_12.15.5 == null or SCH_12.15.5 == "" -%}
                        {% assign PL_Value_Except_PL5_PL9= SCH_12.15.Value | remove: SCH_12.15.9.Value %}
                    {% endif -%}
                {% else -%}
                    {% assign PL_Value_Except_PL5_PL9 = SCH_12.15.Value %}
                {% endif -%}

                {% if SCH_12.15.1 -%}
                {
                    {% evaluate Location_ID_SCH_12 using 'ID/Location' PL_Field_Value: SCH_12.15.1, PL: SCH_12.15, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_12 }}",
                },
                {% elseif SCH_12.15.2 -%}
                {
                    {% evaluate Location_ID_SCH_12 using 'ID/Location' PL_Field_Value: SCH_12.15.2, PL: SCH_12.15, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_12 }}",
                },
                {% elseif SCH_12.15.3 -%}
                {
                    {% evaluate Location_ID_SCH_12 using 'ID/Location' PL_Field_Value: SCH_12.15.3, PL: SCH_12.15, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_12 }}", 
                },   
                {% elseif SCH_12.15.4 -%}
                {
                    {% evaluate Location_ID_SCH_12 using 'ID/Location' PL_Field_Value: SCH_12.15.4, PL: SCH_12.15, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_12 }}",    
                },
                {% elseif SCH_12.15.7 -%}
                {
                    {% evaluate Location_ID_SCH_12 using 'ID/Location' PL_Field_Value: SCH_12.15.7, PL: SCH_12.15, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_12 }}",
                },
                {% elseif SCH_12.15.8 -%}
                {
                    {% evaluate Location_ID_SCH_12 using 'ID/Location' PL_Field_Value: SCH_12.15.8, PL: SCH_12.15, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_12 }}",  
                },  
                {% endif -%}

            {% endif %}

            {% if SCH_16.19 -%}

                {% if  SCH_16.19.5 or  SCH_16.19.9 -%}
                    {% if  SCH_16.19.5 and  SCH_16.19.9 -%}
                        {% assign PL_Value_Except_PL5_PL9 =  SCH_16.19.Value | remove:  SCH_16.19.5.Value | remove:  SCH_16.19.9.Value %}
                    {% endif -%}
                    {% if  SCH_16.19.5 and  SCH_16.19.9 == null or  SCH_16.19.9 == "" -%}
                        {% assign PL_Value_Except_PL5_PL9=  SCH_16.19.Value | remove:  SCH_16.19.5.Value %}
                    {% endif -%}
                    {% if  SCH_16.19.9 and  SCH_16.19.5 == null or  SCH_16.19.5 == "" -%}
                        {% assign PL_Value_Except_PL5_PL9=  SCH_16.19.Value | remove:  SCH_16.19.9.Value %}
                    {% endif -%}
                {% else -%}
                    {% assign PL_Value_Except_PL5_PL9 =  SCH_16.19.Value %}
                {% endif -%}

                {% if  SCH_16.19.1 -%}
                {
                    {% evaluate Location_ID_SCH_16 using 'ID/Location' PL_Field_Value:  SCH_16.19.1, PL:  SCH_16.19, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_16 }}",
                },
                {% elseif  SCH_16.19.2 -%}
                {
                    {% evaluate Location_ID_SCH_16 using 'ID/Location' PL_Field_Value:  SCH_16.19.2, PL:  SCH_16.19, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_16 }}",
                },
                {% elseif  SCH_16.19.3 -%}
                {
                    {% evaluate Location_ID_SCH_16 using 'ID/Location' PL_Field_Value:  SCH_16.19.3, PL:  SCH_16.19, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_16 }}", 
                },   
                {% elseif  SCH_16.19.4 -%}
                {
                    {% evaluate Location_ID_SCH_16 using 'ID/Location' PL_Field_Value:  SCH_16.19.4, PL:  SCH_16.19, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_16 }}",    
                },
                {% elseif  SCH_16.19.7 -%}
                {
                    {% evaluate Location_ID_SCH_16 using 'ID/Location' PL_Field_Value:  SCH_16.19.7, PL:  SCH_16.19, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_16 }}",
                },
                {% elseif  SCH_16.19.8 -%}
                {
                    {% evaluate Location_ID_SCH_16 using 'ID/Location' PL_Field_Value:  SCH_16.19.8, PL:  SCH_16.19, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_16 }}",  
                },  
                {% endif -%}

            {% endif -%}

            {% if SCH_20.22 -%}

                {% if  SCH_20.22.5 or  SCH_20.22.9 -%}
                    {% if  SCH_20.22.5 and  SCH_20.22.9 -%}
                        {% assign PL_Value_Except_PL5_PL9 =  SCH_20.22.Value | remove:  SCH_20.22.5.Value | remove:  SCH_20.22.9.Value %}
                    {% endif -%}
                    {% if  SCH_20.22.5 and  SCH_20.22.9 == null or  SCH_20.22.9 == "" -%}
                        {% assign PL_Value_Except_PL5_PL9=  SCH_20.22.Value | remove:  SCH_20.22.5.Value %}
                    {% endif -%}
                    {% if  SCH_20.22.9 and  SCH_20.22.5 == null or  SCH_20.22.5 == "" -%}
                        {% assign PL_Value_Except_PL5_PL9=  SCH_20.22.Value | remove:  SCH_20.22.9.Value %}
                    {% endif -%}
                {% else -%}
                    {% assign PL_Value_Except_PL5_PL9 =  SCH_20.22.Value %}
                {% endif -%}

                {% if  SCH_20.22.1 -%}
                {
                    {% evaluate Location_ID_SCH_20 using 'ID/Location' PL_Field_Value:  SCH_20.22.1, PL:  SCH_20.22, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_20 }}",
                },
                {% elseif  SCH_20.22.2 -%}
                {
                    {% evaluate Location_ID_SCH_20 using 'ID/Location' PL_Field_Value:  SCH_20.22.2, PL:  SCH_20.22, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_20 }}",
                },
                {% elseif  SCH_20.22.3 -%}
                {
                    {% evaluate Location_ID_SCH_20 using 'ID/Location' PL_Field_Value:  SCH_20.22.3, PL:  SCH_20.22, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_20 }}", 
                },   
                {% elseif  SCH_20.22.4 -%}
                {
                    {% evaluate Location_ID_SCH_20 using 'ID/Location' PL_Field_Value:  SCH_20.22.4, PL:  SCH_20.22, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_20 }}",    
                },
                {% elseif  SCH_20.22.7 -%}
                {
                    {% evaluate Location_ID_SCH_20 using 'ID/Location' PL_Field_Value:  SCH_20.22.7, PL:  SCH_20.22, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_20 }}",
                },
                {% elseif  SCH_20.22.8 -%}
                {
                    {% evaluate Location_ID_SCH_20 using 'ID/Location' PL_Field_Value:  SCH_20.22.8, PL:  SCH_20.22, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    "reference":"Location/{{ Location_ID_SCH_20 }}",  
                },  
                {% endif -%}
            {% endif -%}

            {% if PRT.9 %}
                {
                    {% if PRT.9.5 or PRT.9.9 -%}
                        {% if PRT.9.5 and PRT.9.9 -%}
                            {% assign PL_Value_Except_PL5_PL9 = PRT.9.Value | remove: PRT.9.5.Value | remove: PRT.9.9.Value %}
                        {% endif -%}
                        {% if PRT.9.5 and PRT.9.9 == null or PRT.9.9 == "" -%}
                            {% assign PL_Value_Except_PL5_PL9= PRT.9.Value | remove: PRT.9.5.Value %}
                        {% endif -%}
                        {% if PRT.9.9 and PRT.9.5 == null or PRT.9.5 == "" -%}
                            {% assign PL_Value_Except_PL5_PL9= PRT.9.Value | remove: PRT.9.9.Value %}
                        {% endif -%}
                    {% else -%}
                        {% assign PL_Value_Except_PL5_PL9 = PRT.9.Value %}
                    {% endif -%}

                    {% if PRT.9.1 -%}
                        {% evaluate Location_ID_PRT_9 using 'ID/Location' PL_Field_Value: PRT.9.1, PL: PRT.9, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRT.9.2 -%}
                        {% evaluate Location_ID_PRT_9 using 'ID/Location' PL_Field_Value: PRT.9.2, PL: PRT.9, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRT.9.3 -%}
                        {% evaluate Location_ID_PRT_9 using 'ID/Location' PL_Field_Value: PRT.9.3, PL: PRT.9, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRT.9.4 -%}
                        {% evaluate Location_ID_PRT_9 using 'ID/Location' PL_Field_Value: PRT.9.4, PL: PRT.9, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRT.9.7 -%}
                        {% evaluate Location_ID_PRT_9 using 'ID/Location' PL_Field_Value: PRT.9.7, PL: PRT.9, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRT.9.8 -%}
                        {% evaluate Location_ID_PRT_9 using 'ID/Location' PL_Field_Value: PRT.9.8, PL: PRT.9, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% endif -%}
            
                    {% if Location_ID_PRT_9 -%}
                        "reference":"Location/{{ Location_ID_PRT_9 }}",
                    {% endif -%}
                },
            {% endif %}

            {% if PRD.4 %}
                {
                    {% if PRD.4.5 or PRD.4.9 -%}
                        {% if PRD.4.5 and PRD.4.9 -%}
                            {% assign PL_Value_Except_PL5_PL9 = PRD.4.Value | remove: PRD.4.5.Value | remove: PRD.4.9.Value %}
                        {% endif -%}
                        {% if PRD.4.5 and PRD.4.9 == null or PRD.4.9 == "" -%}
                            {% assign PL_Value_Except_PL5_PL9= PRD.4.Value | remove: PRD.4.5.Value %}
                        {% endif -%}
                        {% if PRD.4.9 and PRD.4.5 == null or PRD.4.5 == "" -%}
                            {% assign PL_Value_Except_PL5_PL9= PRD.4.Value | remove: PRD.4.9.Value %}
                        {% endif -%}
                    {% else -%}
                        {% assign PL_Value_Except_PL5_PL9 = PRD.4.Value %}
                    {% endif -%}

                    {% if PRD.4.1 -%}
                        {% evaluate Location_ID_PRD_4 using 'ID/Location' PL_Field_Value: PRD.4.1, PL: PRD.4, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRD.4.2 -%}
                        {% evaluate Location_ID_PRD_4 using 'ID/Location' PL_Field_Value: PRD.4.2, PL: PRD.4, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRD.4.3 -%}
                        {% evaluate Location_ID_PRD_4 using 'ID/Location' PL_Field_Value: PRD.4.3, PL: PRD.4, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRD.4.4 -%}
                        {% evaluate Location_ID_PRD_4 using 'ID/Location' PL_Field_Value: PRD.4.4, PL: PRD.4, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRD.4.7 -%}
                        {% evaluate Location_ID_PRD_4 using 'ID/Location' PL_Field_Value: PRD.4.7, PL: PRD.4, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% elseif PRD.4.8 -%}
                        {% evaluate Location_ID_PRD_4 using 'ID/Location' PL_Field_Value: PRD.4.8, PL: PRD.4, PL_Value_Except_PL5_PL9: PL_Value_Except_PL5_PL9 -%}
                    {% endif -%}
                
                    {% if Location_ID_PRD_4 -%}
                        "reference":"Location/{{ Location_ID_PRD_4 }}",
                    {% endif -%}
                },
            {% endif %}
        ],
        {% include 'DataType/XCNPractitionerRole' XCN: ROL.4 -%}
        
        "organization":
        { 
            {% if PRT.8 and Organization_ID_PRT_8 -%}
                "reference":"Organization/{{ Organization_ID_PRT_8 }}",
            {% endif -%}
            {% if requestor_organization %}
                "reference":"Organization/{{requestor_organization}}",
            {% endif -%}
        },
        {% include 'DataType/XCNPractitionerRole' XCN: PRT.5.Repeats[0] -%}
        "specialty":
        [
            {% if PRT.5 %}
                {
                    {% include 'DataType/CWECodeableConcept' CWE: PRT.6 -%}
                },
            {% endif %}
        ],
       
        "practitioner" : { 
            {% if requestor_practitioner1 %}
                "reference":"Practitioner/{{requestor_practitioner1}}",
            {% elsif requestor_practitioner2 %}
                "reference":"Practitioner/{{requestor_practitioner2}}",
            {% endif %}
            {% if collection_collector_practitioner %}
                "reference":"Practitioner/{{collection_collector_practitioner}}",
            {% endif %}
            {% if REF_SCH_12 -%}
                "reference":"Practitioner/{{REF_SCH_12}}",
            {% endif -%}
            {% if REF_SCH_16 -%}
            "reference":"Practitioner/{{ REF_SCH_16 }}",
            {% endif -%}
            {% if REF_SCH_20 -%}
            "reference":"Practitioner/{{ REF_SCH_20 }}",
            {% endif -%}
            {% if practitionerId_TXA -%}
            "reference":"Practitioner/{{ practitionerId_TXA }}",
            {% endif -%}
            
         },
    },
    "request":{
        "method":"PUT",
        {% if Root_Template == "ADT_A29" -%}
            "method":"DELETE",
        {% endif -%} 
        "url":"PractitionerRole/{{ ID }}",
    },
},
