{% mergeDiff msg -%}
{
  "what[x]" : "",
  {%if msg.whatUri -%}
  "what" : {
    "reference" : "{{msg.whatUri}}",
    "extension" : [{
      "url" : "http://hl7.org/fhir/r3/StructureDefinition/BaseType",
      "valueString" : "uri"
    }]
  },
  {% else if msg.whatReference -%}
  "what" : {{msg.whatReference |to_json_string}},
  {% else if msg.whatIdentifier -%}
  "what" : {{msg.whatIdentifier |to_json_string}},
  {% endif -%}
  "agent" : [ {{ msg.agent | to_array | batch_render: 'Provenance/Agent', 'msg' }} ]
}
{% endmergeDiff -%}