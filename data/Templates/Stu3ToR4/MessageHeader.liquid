{% mergeDiff msg -%}
{
  "contained" : [ {{msg.contained | to_array | batch_render : 'Resource', 'msg'}} ],
  "eventCoding" : {{msg.event | to_json_string | default : '""'}},
  "destination" : [
    {% for d in msg.destination -%}
    {
      "name" : "{{d.name}}",
      "target" : {{d.target | to_json_string | default : '""'}},
      "endpoint" : "{{d.endpoint}}",
      "receiver" : {{msg.receiver | to_json_string | default : '""'}}
    },
    {% endfor -%}
  ],
  "event" : "",
  "timestamp" : "",
  "receiver" : ""
}
{% endmergeDiff -%}