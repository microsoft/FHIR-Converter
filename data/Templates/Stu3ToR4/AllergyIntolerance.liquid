{% mergeDiff msg -%}
{
  "contained" : [ {{msg.contained | to_array | batch_render : 'Resource', 'msg'}} ],
  {%if msg.clinicalStatus -%}
  "clinicalStatus" : {
    "coding" : {
      "system" : "http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical",
      "code" : "{{msg.clinicalStatus}}"
    }
  },
  {% endif -%}
  {%if msg.verificationStatus -%}
  "verificationStatus" : {
    "coding" : {
      "system" : "http://terminology.hl7.org/CodeSystem/allergyintolerance-verification",
      "code" : "{{msg.verificationStatus}}"
    }
  },
  {% endif -%}
  "recordedDate" : "{{msg.assertedDate | date: "yyyy-MM-ddTHH:mm:ss.fff%K" }}",
  "assertedDate" : ""
}
{% endmergeDiff -%}

